{"version":3,"sources":["../../../../assets/Script/assets/Script/ScratchCardCtrl.js"],"names":["cc","Class","extends","Component","properties","cardBg","Sprite","resultLabel","Label","mask","Mask","promptLabel","sucFlagNode","default","type","Node","tooltip","_sucFlag","Boolean","onLoad","node","on","EventType","TOUCH_START","_onTouchBegin","TOUCH_MOVE","_onTouchMoved","TOUCH_END","_onTouchEnd","TOUCH_CANCEL","_onTouchCancel","i","length","push","onDestroy","_removeTouchEvent","off","start","event","log","point","touch","getLocation","convertToNodeSpaceAR","_addCircle","stencil","_clippingStencil","color","drawPoly","_calculateCircle","p","CC_JSB","renderer","childrenOrderDirty","_checkFinish","res","rectContainsPoint","getBoundingBox"],"mappings":"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","file":"ScratchCardCtrl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        cardBg: cc.Sprite,      // 底层精灵\n        resultLabel: cc.Label,  \n        mask: cc.Mask,          // 遮罩组件（实现擦除功能）\n        promptLabel: cc.Label,  // 提示文字\n        sucFlagNode: {\n            default: [],   \n            type: [cc.Node],\n            tooltip:\"标记需要擦除区域，每个node大小为单次擦除大小，默认30像素。\"\n        },\n        _sucFlag:[cc.Boolean] //标记已经擦除的区域\n    },\n\n    // use this for initialization\n    onLoad: function (){\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegin, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancel, this);\n\n        for(var i=0; i<this.sucFlagNode.length; i++){\n            this._sucFlag.push(false);\n        }\n    },\n\n    onDestroy:function () {\n        this._removeTouchEvent();\n    },\n\n    _removeTouchEvent: function(){\n        this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchBegin, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancel, this);\n    },\n\n    start:function () {\n       //\n\n\n        // var x =-100;\n        // var y =-100;\n        // var width =300;\n        // var height = 200;\n        // var rectangle = [cc.v2(x, y),\n        //     cc.v2(x + width, y),\n        //     cc.v2(x + width, y + height),\n        //     cc.v2(x, y + height)];\n        //\n        // stencil.drawPoly(rectangle, color, 0, color);\n\n        // stencil.drawPoly(this.mask._calculateCircle(cc.p(0,0),cc.p(100,100), 64), color, 0, color);\n        //\n        // stencil.drawPoly(this.mask._calculateCircle(cc.p(200,200),cc.p(50,50), 64), color, 0, color);\n\n    },\n\n    _onTouchBegin:function (event) {\n\n        cc.log('touchBegin');\n\n        var point = event.touch.getLocation();\n        point = this.node.convertToNodeSpaceAR(point);\n        this._addCircle(point);\n    },\n\n    _onTouchMoved:function (event) {\n        var point = event.touch.getLocation();\n        point = this.node.convertToNodeSpaceAR(point);\n        this._addCircle(point);\n    },\n\n    _onTouchEnd:function (event) {\n        var point = event.touch.getLocation();\n        point = this.node.convertToNodeSpaceAR(point);\n        this._addCircle(point);\n    },\n\n    _onTouchCancel:function (event) {\n        // var point = event.touch.getLocation();\n        // point = this.node.convertToNodeSpaceAR(point);\n        // this._addCircle(point);\n    },\n\n    _addCircle:function (point) {\n        var stencil = this.mask._clippingStencil;\n        var color = cc.color(255, 255, 255, 0);\n        stencil.drawPoly(this.mask._calculateCircle(point,cc.p(30,30), 64), color, 0, color);\n        if (!CC_JSB) {\n            cc.renderer.childrenOrderDirty = true;\n        }    \n        this._checkFinish(point);    \n    },\n\n    _checkFinish: function(point){\n        var res = true;\n        for (var i=0; i<this.sucFlagNode.length; i++){\n            var node = this.sucFlagNode[i];\n            if (cc.rectContainsPoint(node.getBoundingBox(), point)){\n                this._sucFlag[i] = true;\n            }\n            if (!this._sucFlag[i]){\n                res = false;\n            }\n        }\n        if (res){\n            this._removeTouchEvent();\n            cc.log(\"擦除完成...\");\n        }\n    }\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n\n"]}